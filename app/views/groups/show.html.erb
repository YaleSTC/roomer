<%= render 'group_details' %>
<% if policy(@group).view_pending_members? %>
  <% unless @group.requests.empty? %>
    <h3 class="group-requests">Requests:</h3>
    <ul>
      <% @group.requests.each do |r| %>
        <li class="group-request">
          <%= r.full_name %>
          <% if policy(@group).accept_request? %>
            (<%= link_to 'accept', accept_request_draw_group_path(@draw, @group, params: { 'user_id' => r.id }), method: :put %><%= policy(@group).reject_pending? ? ' / ' : ')' %>
          <% end %>
          <% if policy(@group).reject_pending? %>
            <%= '(' unless policy(@group).accept_request? %><%= link_to 'reject', reject_pending_draw_group_path(@draw, @group, params: { 'user_id' => r.id }), method: :put %>)
          <% end %>
        </li>
      <% end %>
    </ul>
  <% end %>
  <% unless @group.invitations.empty? %>
    <h3 class="group-invitations">Invitations:</h3>
    <ul>
      <% @group.invitations.each do |i| %>
        <li class="group-invitation">
          <%= i.full_name %>
          <% if policy(@group).reject_pending? %>
            (<%= link_to 'rescind', reject_pending_draw_group_path(@draw, @group, params: { 'user_id' => i.id }), method: :put %>)
          <% end %>
        </li>
      <% end %>
    </ul>
  <% end %>
<% end %>
<hr style="border-color: #DDDDDD;" />
<div>
  <%= link_to 'Edit', edit_draw_group_path(@draw, @group), class: 'button secondary' if policy(@group).edit? %>
  <%= link_to 'Request To Join', request_draw_group_path(@draw, @group), method: :post, class: 'button secondary' if policy(@group).request_to_join? %>
  <% if policy(@group).leave? %>
    <%= link_to 'Leave group', leave_draw_group_path(@draw, @group), method: :delete, class: 'button alert' %>
  <% end %>
  <%= link_to 'Invite Members', invite_draw_group_path(@draw, @group), class: 'button secondary' if policy(@group).invite? %>
  <%= link_to 'Accept Invitation', accept_invitation_draw_group_path(@draw, @group), method: :put, class: 'button' if policy(@group).accept_invitation? %>
  <%= link_to 'Lock Group', lock_draw_group_path(@draw, @group), method: :put, class: 'button alert' if policy(@group).lock? %>
  <%= link_to 'Finalize Group', finalize_draw_group_path(@draw, @group), method: :put, class: 'button' if policy(@group).finalize? %>
  <%= link_to 'Finalize Membership', finalize_membership_draw_group_path(@draw, @group), method: :put, class: 'button' if policy(@group).finalize_membership? %>
  <%= link_to('Disband', draw_group_path(@draw, @group), method: :delete, class: 'button alert') if policy(@group).destroy? %>
</div>
<%= link_to 'Return to draw', draw_path(@draw) %>

<% content_for :sidebar do %>
  <h3><%= @same_size_groups_count %> <%= 'group'.pluralize(@same_size_groups_count) %> of size <%= @group.size %></h3>
  <h3><%= @compatible_suites.count %> available <%= size_str(@group.size).capitalize.pluralize(@compatible_suites.count) %></h3>
  <% unless @compatible_suites.count.zero? %>
    <%= render 'groups/suites_table', suites: @compatible_suites %>
  <% end %>
<% end %>
